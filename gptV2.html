<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Super Simple Calculator</title>
  <style>
    :root { --bg:#111; --panel:#1b1b1b; --btn:#2a2a2a; --btn-op:#3a3a3a; --accent:#4caf50; --text:#f2f2f2; }
    * { box-sizing:border-box; }
    body { margin:0; min-height:100svh; display:grid; place-items:center; background:var(--bg); color:var(--text); font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    .calc { width:min(360px, 92vw); background:var(--panel); border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.35); padding:14px; }
    .display { height:72px; background:#000; color:#0ff; font: bold 32px/72px ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; text-align:right; padding:0 12px; border-radius:12px; overflow:hidden; white-space:nowrap; }
    .keys { margin-top:12px; display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; }
    button { border:0; border-radius:12px; height:56px; background:var(--btn); color:var(--text); font-size:18px; cursor:pointer; }
    button.op { background:var(--btn-op); }
    button.equal { background:var(--accent); color:#031; font-weight:700; }
    button.span-2 { grid-column: span 2; }
    button:active { transform:translateY(1px); }
  </style>
</head>
<body>
  <div class="calc" role="application" aria-label="Simple calculator">
    <div id="display" class="display" aria-live="polite">12345</div>

    <div class="keys">
      <button data-action="clear" class="span-2">C</button>
      <button data-action="back">âŒ«</button>
      <button data-op="/" class="op">Ã·</button>

      <button data-digit="7">7</button>
      <button data-digit="8">8</button>
      <button data-digit="9">9</button>
      <button data-op="*" class="op">Ã—</button>

      <button data-digit="4">4</button>
      <button data-digit="5">5</button>
      <button data-digit="6">6</button>
      <button data-op="-" class="op">âˆ’</button>

      <button data-digit="1">1</button>
      <button data-digit="2">2</button>
      <button data-digit="3">3</button>
      <button data-op="+" class="op">+</button>

      <button data-digit="0" class="span-2">0</button>
      <button data-dot=".">.</button>
      <button data-action="equals" class="equal">=</button>
    </div>
  </div>

<script>
// ====== 1) Basic math functions (try these in the console!) ======
function add(a, b) { return a + b; }
function subtract(a, b) { return a - b; }
function multiply(a, b) { return a * b; }
function divide(a, b) { return a / b; }

// ====== 2) Operation pieces ======
// We'll keep the current operation as three pieces: firstNumber, operator, secondNumber.
let firstNumber = null;   // e.g. 12
let operator = null;      // e.g. "+"
let secondNumber = null;  // e.g. 7

// ====== 3) operate(op, a, b) ======
function operate(op, a, b) {
  switch (op) {
    case '+': return add(a, b);
    case '-': return subtract(a, b);
    case '*': return multiply(a, b);
    case '/': return divide(a, b);
    default: return b; // if no operator, just return the second number
  }
}

// ====== 4) DOM bits ======
const display = document.getElementById('display');
const keys = document.querySelector('.keys');

// Start with dummy numbers so the display "looks right"
setDisplay('0');

// A few helper flags
let lastKeyType = 'digit'; // 'digit' | 'operator' | 'equals' | 'clear' | 'dot'
let resultJustShown = false; // After showing a result, next digit starts a fresh number
let errorState = false;      // For divide-by-zero, etc.

// ====== Helpers ======
function setDisplay(value) {
  display.textContent = value;
}

function getDisplayNumber() {
  return display.textContent;
}

function roundForDisplay(num) {
  // Avoid super long decimals. Convert to a string with up to 12 significant digits.
  // Then trim trailing zeros and a trailing dot.
  const str = Number(num).toPrecision(12);
  let clean = str.replace(/\.0+$/,'').replace(/(\.[0-9]*?)0+$/,'$1');
  // Prevent overflow: if still too long, switch to exponential with 8 digits.
  if (clean.length > 12 && isFinite(num)) clean = Number(num).toExponential(8);
  return clean;
}

function clearAll() {
  firstNumber = null;
  secondNumber = null;
  operator = null;
  resultJustShown = false;
  lastKeyType = 'clear';
  errorState = false;
  setDisplay('0');
}

function backspace() {
  if (resultJustShown || errorState) return; // do nothing on result/error
  const current = getDisplayNumber();
  if (current.length <= 1 || current === '0') { setDisplay('0'); return; }
  setDisplay(current.slice(0, -1));
}

function inputDigit(d) {
  if (errorState) return; // must press clear
  if (resultJustShown || getDisplayNumber() === '0' || lastKeyType === 'operator' || lastKeyType === 'equals') {
    setDisplay(String(d));
    resultJustShown = false;
  } else {
    if (getDisplayNumber().length < 12) setDisplay(getDisplayNumber() + String(d));
  }
  lastKeyType = 'digit';
}

function inputDot() {
  if (errorState) return;
  let current = getDisplayNumber();
  if (resultJustShown || lastKeyType === 'operator' || lastKeyType === 'equals') {
    setDisplay('0.');
    resultJustShown = false;
  } else if (!current.includes('.')) {
    setDisplay(current + '.');
  }
  lastKeyType = 'dot';
}

function chooseOperator(op) {
  if (errorState) return;
  const currentValue = Number(getDisplayNumber());

  // If we already have an operator and the last key was a digit or dot, we have a full pair -> evaluate first
  if (operator && (lastKeyType === 'digit' || lastKeyType === 'dot')) {
    secondNumber = currentValue;
    const result = evaluate();
    if (errorState) return; // stop if error
    firstNumber = result;
    setDisplay(roundForDisplay(result));
  } else {
    // If consecutive operator presses, just replace the operator (do not evaluate)
    if (firstNumber === null) firstNumber = currentValue;
  }

  operator = op; // take the latest operator
  lastKeyType = 'operator';
}

function pressEquals() {
  if (errorState) return;
  if (!operator) return; // need an operator

  // Only run when we have two numbers: firstNumber and display (as second)
  if (lastKeyType === 'operator' || lastKeyType === 'equals') return; // avoid premature equals

  secondNumber = Number(getDisplayNumber());
  const result = evaluate();
  if (errorState) return;
  setDisplay(roundForDisplay(result));
  firstNumber = result; // allow chaining (using result as next firstNumber)
  resultJustShown = true;
  lastKeyType = 'equals';
}

function evaluate() {
  if (operator === '/' && secondNumber === 0) {
    setDisplay("Nice try ðŸ˜ â€” can't divide by 0");
    errorState = true;
    return NaN;
  }
  const out = operate(operator, Number(firstNumber), Number(secondNumber));
  return out;
}

// ====== Wire up the buttons ======
keys.addEventListener('click', (e) => {
  const btn = e.target.closest('button');
  if (!btn) return;

  if (btn.dataset.digit !== undefined) {
    inputDigit(btn.dataset.digit);
    return;
  }

  if (btn.dataset.dot !== undefined) {
    inputDot();
    return;
  }

  if (btn.dataset.op) {
    chooseOperator(btn.dataset.op);
    return;
  }

  if (btn.dataset.action === 'equals') { pressEquals(); return; }
  if (btn.dataset.action === 'clear') { clearAll(); return; }
  if (btn.dataset.action === 'back')  { backspace(); return; }
});

// ====== Keyboard support (optional but handy) ======
document.addEventListener('keydown', (e) => {
  if (e.key >= '0' && e.key <= '9') inputDigit(e.key);
  if (e.key === '.') inputDot();
  if (['+','-','*','/'].includes(e.key)) chooseOperator(e.key);
  if (e.key === 'Enter' || e.key === '=') pressEquals();
  if (e.key === 'Escape') clearAll();
  if (e.key === 'Backspace') backspace();
});

</script>
</body>
</html>
